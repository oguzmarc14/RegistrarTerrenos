---
import Layout from "../../layouts/Layout.astro";
import CardMostrarTerreno from "../../components/ui/CardMostrarTerreno.astro";
import Navbar from "../../components/ui/Navbar.astro";
import Footer from "../../components/sections/Footer.astro";
import TipoTerreno from "../../components/ui/TipoTerreno.astro";
import { supabase } from "../../lib/supabaseClient";

const { data: terrenos, error } = await supabase
  .from("Terrenos")
  .select("*")
  .eq("tipo", "casa")
  .order("fecha", { ascending: false });
---

<Layout>
  <section class="bg-gradient-to-b from-sky-950 via-sky-950 to-sky-950/90">
    <div>
      <Navbar />
    </div>

    <div class="text-center px-6 mt-8">
      <h2 class="text-4xl md:text-5xl text-white">
        Casas en venta y renta en Encarnación de Díaz
      </h2>
      <p class="text-sky-100/80 max-w-4xl mx-auto mt-4">
        Encuentra casas ideales para inversión o vivienda. Consulta precios, ubicación y características actualizadas.
      </p>
      <div class="mt-6">
        <TipoTerreno />
      </div>
    </div>

    <div class="text-center max-w-4xl mx-auto mb-12">
      <p class="text-lg text-sky-100/80 leading-relaxed">
        Aquí puedes ver todas las casas actualmente en venta o renta.
      </p>
    </div>

    {error && <p class="text-red-500 text-center">Error al cargar terrenos</p>}

    <div
      class="grid gap-14 md:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-3 xl:max-w-[1300px] 2xl:max-w-[1700px] mx-auto px-8 mb-12"
    >
      {
        Array.isArray(terrenos) &&
          terrenos.map((terreno) => (
            <CardMostrarTerreno
              imagenes={terreno.imagenes}
              titulo={terreno.titulo}
              descripcion={terreno.descripcion}
              precio={terreno.precio}
              textBoton="Ver más"
              hrefBoton="#"
              medidas={terreno.medidas}
              ubicacion={terreno.ubicacion}
              fecha={terreno.fecha}
            />
          ))
      }
    </div>

    <Footer />
  </section>
</Layout>
